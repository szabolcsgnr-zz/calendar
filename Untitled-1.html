<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Calendar</title>

<style>
* { margin: 0; padding: 0;}

body, html { height:100%; }

#evCanvas {
    position:absolute;
    width:100%;
    height:100%;
}
#popUpBox {
    position:relative;
    width:0px;
    height:0px;
	top:0px;
	left:0px;

	
}
.menu {
    position:absolute;
    width:100px;
    height:60px;
	bottom:0px;
	z-index:2;
	background:#6FF;
	
	
transition-property:width;
transition-duration:1s;
transition-timing-function:linear;

/* Safari */
-webkit-transition-property:width;
-webkit-transition-duration:1s;
-webkit-transition-timing-function:linear;
}
.menu:hover{
	width:500px;
	
	}
</style>
</head>

<body onload="init()">
<div id="popUpBox">


</div>
<div class="menu">
<a href="#" onclick="newEvent()">Új esemény létrehozása</a>
</div>

<canvas id="evCanvas" onclick="popUp()">

Your browser does not support the HTML5 canvas tag.
</canvas>


<script>
var c=document.getElementById("evCanvas");
var ctx=c.getContext("2d");
var eventNames=new Array();
var eventDates=new Array();

eventDates[0]= "ma 2 kor";
eventDates[1]= "ma 3 kor";
eventDates[2]= "holnap reggel 8-kor";
eventDates[3]= "holnap reggel 10-kor";
eventDates[4]= "holnap";
eventDates[5]= "holnap után";
eventDates[6]= "január 27.";


var coordinatesX=new Array();
var coordinatesY=new Array();
var coordinatesZ=new Array();
var txtSize=new Array();
var mousePos;

var inFocusName;
var prevZ;

function init() {
 	ctx.canvas.width  = window.innerWidth;
  	ctx.canvas.height = window.innerHeight;
	initEvents();
}

function initEvents(){
	for(i=0; i<7; i++){
		eventNames[i]="eventName"+i;	
	}
	calculatePositions(eventNames);
}
	
function calculatePositions(eventNames){
		for(i=0; i<eventNames.length;i++){
			eventNames[i];
			
			var x; 
			var y;

		
				x=Math.floor((Math.random()* window.innerWidth/1.5)+100);
				y=Math.floor((Math.random()* window.innerHeight/1.5)+100);
				for(elozo=0; elozo<i;elozo++){
					if(Math.abs(x-coordinatesX[elozo])<300){
						if(Math.abs(y-coordinatesY[elozo])<50){
							calculatePositions(eventNames);
							return;
							}
						
						}}
			
			
			
			coordinatesX[i]=x;
			coordinatesY[i]=y;
			coordinatesZ[i]=i+1;
			
			}
		redraw();	
}
	
	
function redraw(){
	ctx.clearRect ( 0 , 0 ,  window.innerWidth,  window.innerHeight);
		for(i=0; i<eventNames.length;i++){
			var meret=70-9*coordinatesZ[i];
			if(meret<10){meret=10;}
			ctx.font=meret+"px Arial";
			ctx.fillText(eventNames[i],coordinatesX[i],coordinatesY[i]);
			var metrics = ctx.measureText(eventNames[i]);
    	var txtwidth = metrics.width;
		txtSize[i]=txtwidth;
			
			ctx.font=30/coordinatesZ[i]+"px Arial";
			ctx.fillText(eventDates[i],coordinatesX[i],coordinatesY[i]+30/coordinatesZ[i]);
			
		
		
			
		}
}


function getMousePos(c, evt) {
        var rect = c.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }

c.addEventListener('mousemove', function(evt) {
        mousePos = getMousePos(c, evt);
		eventsFocus();
      
      }, false);

function eventsFocus(){
	//calculatePositions(eventNames);
	outFocus();
	var valami;
	for(i=0;i<eventNames.length;i++){

	
	
		if(mousePos.x>coordinatesX[i]){
			if(mousePos.x<coordinatesX[i]+txtSize[i]){
				if( mousePos.y>coordinatesY[i]-70/coordinatesZ[i]){
					if( mousePos.y<coordinatesY[i]){
						//document.getElementById("menu").innerHTML=eventNames[i];
						inFocus(eventNames[i]);
						break;
					}
				}
		}
	}
	
	}

	
	
}
function inFocus(name){
	inFocusName=name;
	var index=eventNames.indexOf(name);
	prevZ=coordinatesZ[index];
	coordinatesZ[index]=1;
	redraw();
	
	}
function outFocus(){
	
	var index=eventNames.indexOf(inFocusName);
	coordinatesZ[index]=prevZ;
	redraw();
	
	}
function popUp(){
	document.getElementById("popUpBox").innerHTML="";
	var valami;
	for(i=0;i<eventNames.length;i++){

	
	
		if(mousePos.x>coordinatesX[i]){
			if(mousePos.x<coordinatesX[i]+txtSize[i]){
				if( mousePos.y>coordinatesY[i]-70/coordinatesZ[i]){
					if( mousePos.y<coordinatesY[i]){
						var xx;
						var yy;
						if (mousePos.x> window.innerWidth/2){xx=mousePos.x-300}else{xx=mousePos.x}
						if (mousePos.y> window.innerHeight/2){yy=mousePos.y-300}else{yy=mousePos.y}
						
						document.getElementById("popUpBox").innerHTML="<style> #popUpBoxy{ 	position:absolute; top:"+yy+"px; left:"+xx+"px;"+
    "width:300px;height:300px;background:rgba(204,204,204,1);	}"+
	"</style><div id=\"popUpBoxy\"></div>";
						break;
					}
				}
		}
	}
	
	}
}

function newEvent(){
	eventNames.unshift("Ez egy új event");
	eventDates.unshift("holnap délben");
	calculatePositions(eventNames);
	}
</script>




</body>
</html>
